{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>社内問合せアプリ</title>
  <link rel="stylesheet" href="{% static 'style.css' %}?v=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="chat-page">
  <!-- ヘッダー -->
  <header class="chat-header">
    <div class="chat-header-left">
      <h1 class="app-title">社内問合せアプリ</h1>
      <p class="app-subtitle">
        人事・総務・経理・法務・情シスへの問い合わせを一元管理する社内向けチャットボットです。
      </p>
    </div>
    <div class="chat-header-right">
      <div class="chat-admin-link">
        {% if user.is_authenticated %}
          <span class="login-user">ログイン中：{{ user.username }} さん</span>
          <a class="admin-button" href="{% url 'documents:dashboard' %}">
            管理画面へ
          </a>
          <form method="post" action="{% url 'chat:reset' %}">
            {% csrf_token %}
            <button type="submit">会話をリセット</button>
          </form>
        {% else %}
          <span class="login-user login-user--guest">未ログイン</span>
          <a class="admin-button" href="{% url 'accounts:login' %}?next={% url 'documents:dashboard' %}">
            管理画面ログイン
          </a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- メインエリア -->
  <main class="chat-main">

    <!-- 左サイド：回答部門／拡張枠 -->
    <aside class="chat-side-left">
      <section class="panel">
        <h2 class="panel-title">回答部門</h2>
        <p class="panel-body dept-name">
          {{ meta|default:"部門名" }}
        </p>
      </section>

      <section class="panel">
        <h2 class="panel-title">拡張エリア（例）</h2>
        <div class="panel-body">
          会話履歴一覧や、「担当部門別の問い合わせ件数」などを表示するエリアとして利用できます。
        </div>
      </section>
    </aside>

    <!-- 中央：メッセージエリア＋入力欄 -->
    <section class="chat-center">
      <div class="messages-area" id="messages">
        {% for message in messages %}
          <div class="message-row {% if message.role == 'assistant' %}is-assistant{% else %}is-user{% endif %}">
            <div class="message-bubble">
              {{ message.content }}
            </div>
          </div>
        {% empty %}
          <div class="message-row is-assistant">
            <div class="message-bubble">
              AIアシスタントからの回答がここに表示されます。
            </div>
          </div>
          <div class="message-row is-user">
            <div class="message-bubble">
              あなたの問い合わせ内容がここに表示されます。
            </div>
          </div>
        {% endfor %}
      </div>

      <form method="post" class="chat-input-area">
        {% csrf_token %}
        <label class="input-label" for="message-input">
          問い合わせ内容
        </label>
        <div class="input-row">
          <textarea id="message-input" name="message" rows="3"
                    placeholder="例）4月入社の新卒社員の有給休暇付与日を教えてください。"></textarea>
          <button type="submit" class="submit-button">送信</button>
        </div>
        <p class="input-hint">
          Shift + Enter で改行できます。
        </p>
      </form>
    </section>

    <!-- 右サイド：出典表示エリア等 -->
    <aside class="chat-side-right">
      <section class="panel">
        <h2 class="panel-title">出典／資料表示エリア</h2>
        <div class="panel-body">
          回答に利用した PDF や社内規程の抜粋をここに表示する想定です。<br>
          例：<br>
          ・就業規則 PDF のプレビュー<br>
          ・経費精算マニュアルの該当ページ<br>
          ・問い合わせに紐づくドキュメント一覧 など
        </div>
      </section>
    </aside>

  </main>

</div>
</body>
</html>
